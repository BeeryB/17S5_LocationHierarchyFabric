{"version":3,"file":"Rating.js","sourceRoot":"../src/","sources":["components/Rating/Rating.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\r\nimport {\r\n  BaseComponent,\r\n  css,\r\n  getId\r\n} from '../../Utilities';\r\nimport { Icon } from '../../Icon';\r\nimport { FocusZone, FocusZoneDirection } from '../../FocusZone';\r\nimport { IRatingProps, RatingSize } from './Rating.types';\r\nimport * as stylesImport from './Rating.scss';\r\nimport { format } from '../../Utilities';\r\n\r\nconst styles: any = stylesImport;\r\n\r\ninterface IRatingStarProps extends React.AllHTMLAttributes<HTMLElement> {\r\n  fillPercentage: number;\r\n  disabled: boolean;\r\n}\r\n\r\nexport interface IRatingState {\r\n  rating: number | null | undefined;\r\n}\r\n\r\nconst RatingStar = (props: IRatingStarProps) => (\r\n  <div\r\n    className={ css('ms-RatingStar-container', styles.ratingStar) }\r\n    key={ props.id }\r\n  >\r\n    <Icon\r\n      className={ css('ms-RatingStar-back', styles.ratingStarBack, {\r\n        ['is-disabled ' + styles.ratingStarDisabled]: props.disabled\r\n      }) }\r\n      iconName='FavoriteStarFill'\r\n    />\r\n    { !props.disabled &&\r\n      <Icon\r\n        className={ css('ms-RatingStar-front', styles.ratingStarFront) }\r\n        iconName='FavoriteStarFill'\r\n        style={ { width: props.fillPercentage + '%' } }\r\n      />\r\n    }\r\n  </div>\r\n);\r\n\r\nexport class Rating extends BaseComponent<IRatingProps, IRatingState> {\r\n  public static defaultProps: IRatingProps = {\r\n    min: 1,\r\n    max: 5\r\n  };\r\n  private _id: string;\r\n  private _labelId: string;\r\n\r\n  constructor(props: IRatingProps) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      rating: this._getInitialValue(props)\r\n    };\r\n\r\n    this._id = getId('Rating');\r\n    this._labelId = getId('RatingLabel');\r\n  }\r\n\r\n  public componentWillReceiveProps(nextProps: IRatingProps) {\r\n    if (typeof nextProps.rating !== 'undefined' && nextProps.rating !== this.state.rating) {\r\n      this.setState({\r\n        rating: this._getClampedRating(nextProps.rating)\r\n      } as IRatingState);\r\n    }\r\n  }\r\n\r\n  public render() {\r\n    let stars = [];\r\n\r\n    for (let i = this.props.min as number; i <= (this.props.max as number); i++) {\r\n      let ratingStarProps: IRatingStarProps = {\r\n        fillPercentage: this._getFillingPercentage(i),\r\n        disabled: this.props.disabled ? true : false\r\n      };\r\n\r\n      stars.push(\r\n        <button\r\n          className={ css('ms-Rating-button', styles.ratingButton, {\r\n            ['ms-Rating--large ' + styles.rootIsLarge]: this.props.size === RatingSize.Large,\r\n            ['ms-Rating--small ' + styles.rootIsSmall]: this.props.size !== RatingSize.Large\r\n          }) }\r\n          key={ i }\r\n          { ...((i === Math.ceil(this.state.rating as number)) ? { 'data-is-current': true } : {}) }\r\n          onFocus={ this._onFocus.bind(this, i) }\r\n          disabled={ this.props.disabled || this.props.readOnly ? true : false }\r\n          role='presentation'\r\n        >\r\n          { this._getLabel(i) }\r\n          <RatingStar key={ i + 'rating' }  {...ratingStarProps} />\r\n        </button>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div\r\n        className={ css('ms-Rating-star') }\r\n        aria-label={ this.props.getAriaLabel ? this.props.getAriaLabel(this.state.rating ? this.state.rating : 0, this.props.max as number) : '' }\r\n      >\r\n        <FocusZone\r\n          direction={ FocusZoneDirection.horizontal }\r\n          tabIndex={ this.props.readOnly ? 0 : -1 }\r\n          className={ css('ms-Rating-focuszone', styles.ratingFocusZone) }\r\n        >\r\n          { stars }\r\n        </FocusZone>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private _onFocus(value: number, ev: React.FocusEvent<HTMLElement>): void {\r\n    this.setState({\r\n      rating: value\r\n    } as IRatingState);\r\n\r\n    const { onChanged } = this.props;\r\n    if (onChanged) {\r\n      onChanged(value);\r\n    }\r\n  }\r\n\r\n  private _getLabel(rating: number): JSX.Element {\r\n    const text = this.props.ariaLabelFormat || '';\r\n\r\n    return (\r\n      <span\r\n        id={ `${this._labelId}-${rating}` }\r\n        className={ css('ms-Rating-labelText', styles.labelText) }\r\n      >\r\n        { format(text, rating, this.props.max) }\r\n      </span>\r\n    );\r\n  }\r\n\r\n  private _getInitialValue(props: IRatingProps) {\r\n    if (typeof props.rating === 'undefined') {\r\n      return props.min;\r\n    }\r\n\r\n    if (props.rating === null) {\r\n      return null;\r\n    }\r\n\r\n    return this._getClampedRating(props.rating);\r\n  }\r\n\r\n  private _getClampedRating(rating: number): number {\r\n    return Math.min(Math.max(rating, this.props.min as number), this.props.max as number);\r\n  }\r\n\r\n  private _getFillingPercentage(starPosition: number): number {\r\n    let ceilValue = Math.ceil((this.state.rating as number));\r\n    let fillPercentage = 100;\r\n\r\n    if (starPosition === this.state.rating) {\r\n      fillPercentage = 100;\r\n    } else if (starPosition === ceilValue) {\r\n      fillPercentage = 100 * (this.state.rating as number % 1);\r\n    } else if (starPosition > ceilValue) {\r\n      fillPercentage = 0;\r\n    }\r\n    return fillPercentage;\r\n  }\r\n}\r\n"]}